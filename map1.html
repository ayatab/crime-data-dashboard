<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Crimes in Seattle 2018-2022</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.8.1/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.8.1/mapbox-gl.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
        }

        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }

        /* the text color of a hyper link */
        a {
            color: black
        }

        #title {
            position: absolute;
            top: 0;
            left: 0;
            margin-top: 60px;
            margin-left: 20px;
            font-family: 'Open Sans', sans-serif;
            font-size: 25pt;
            color: white;

        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
        }

        /* #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        } */

        a {
            text-decoration: none;
            color: #2dc4b2;
        }

        #console {
            position: absolute;
            margin: 10px;
            width: 240px;
            background-color: white;
            padding: 20px 20px;
            border-radius: 10px;

        }

        .label {
            width: 15%;
            display: inline-block;
            text-align: center;
        }

        .filter-group {
            font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
            font-weight: 600;
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1;
            border-radius: 3px;
            width: 120px;
            color: #fff;
        }
    </style>
</head>

<body>

    <div id="map"></div>
    <div id="legend"></div>
    <nav class="navbar navbar-light bg-light">
        <a class="navbar-brand" href="#">Seattle Crimes</a>
    </nav>
    <!-- <div id="title" class="my-7">
        Crimes in Seattle from 2018-2022
    </div> -->
    <div class="mx-3">
        <h2>Day of the week</h2>
        <div id="console">
            <div>
                <h5>Filter by year:</h5>
                <div class='' id='filters'>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="toggle" id="all" value="all"
                            checked="checked">
                        <label class="form-check-label" for="all">
                            All
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="toggle" id="2018" value="2018"
                            checked="checked">
                        <label class="form-check-label" for="2018">
                            2018
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="toggle" id="2019" value="2019"
                            checked="checked">
                        <label class="form-check-label" for="2019">
                            2019
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="toggle" id="2020" value="2020"
                            checked="checked">
                        <label class="form-check-label" for="2020">
                            2020
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="toggle" id="2021" value="2021"
                            checked="checked">
                        <label class="form-check-label" for="2021">
                            2021
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="toggle" id="2021" value="2022"
                            checked="checked">
                        <label class="form-check-label" for="2022">
                            2022
                        </label>
                    </div>
                </div>

                <h5>Filter by crime:</h5>
                <div class='' id='crimetype'>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="toggle" id="all" value="all"
                            checked="checked">
                        <label class="form-check-label" for="all">
                            All
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="toggle" id="assault" value="assault"
                            checked="checked">
                        <label class="form-check-label" for="assault">
                            Assault Offenses
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="toggle" id="burglar" value="burglar"
                            checked="checked">
                        <label class="form-check-label" for="burglar">
                            Burglary or Breaking In
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="toggle" id="drugs" value="drugs"
                            checked="checked">
                        <label class="form-check-label" for="drugs">
                            Drugs and Narcotic Offenses
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="toggle" id="dui" value="dui"
                            checked="checked">
                        <label class="form-check-label" for="dui">
                            Driving Under the Influence
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="toggle" id="fraud" value="fraud"
                            checked="checked">
                        <label class="form-check-label" for="fraud">
                            Fraud Offenses
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="toggle" id="mvt" value="mvt"
                            checked="checked">
                        <label class="form-check-label" for="mvt">
                            Motor Vehicle Theft
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="toggle" id="property" value="property"
                            checked="checked">
                        <label class="form-check-label" for="property">
                            Tresspass of Property
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="toggle" id="robbery" value="robbery"
                            checked="checked">
                        <label class="form-check-label" for="robbery">
                            Robbery
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="toggle" id="theft" value="theft"
                            checked="checked">
                        <label class="form-check-label" for="theft">
                            Theft
                        </label>
                    </div>
                </div>
            </div>
            <p>
                <strong>Data:</strong>
                <a href="https://data.seattle.gov/Public-Safety/SPD-Crime-Data-2008-Present/tazs-3rd5">Seattle Crimes
                    Since 2008, filtered for 2018-2022</a>
                collected by SPD in Seattle, 2008-Live
            </p>
        </div>

    </div>
    <script>
        mapboxgl.accessToken =
            'pk.eyJ1IjoiamFrb2J6aGFvIiwiYSI6ImNpcms2YWsyMzAwMmtmbG5icTFxZ3ZkdncifQ.P9MBej1xacybKcDN_jehvw';
        let map = new mapboxgl.Map({
            container: 'map', // container ID
            style: 'mapbox://styles/mapbox/dark-v10',
            zoom: 12, // starting zoom
            center: [-122.3259435, 47.6002614] // starting center
        });


        map.on('load', () => { //simplifying the function statement: arrow with brackets to define a function
            // when loading a geojson, there are two steps
            // add a source of the data and then add the layer out of the source

            let filterYear = ['!=', ['string', ['get', 'Report Number']], 'placeholder'];
            let filterCrime = ['!=', ['string', ['get', 'Offense Parent Group']], 'placeholder'];


            imageArray = ['imgs/theft.png', 'imgs/destruction.png', 'imgs/assault.png', 'imgs/burglar.png', 'imgs/dui.png', 'imgs/drugs.png', 'imgs/fraud.png', 'imgs/mvt.png', 'imgs/robbery.png', 'imgs/property.png', 'imgs/police.png']
            idArray = []

            for (imageItem of imageArray) {
                const imageName = imageItem.substring(imageItem.indexOf('/') + 1, imageItem.indexOf('.'));

                map.loadImage(imageItem, (error, image) => {
                    if (error) throw error;
                    map.addImage(imageName, image);
                });
            }

            map.addLayer({
                'id': 'crimes',
                'type': 'symbol',
                'source': {
                    type: 'geojson',
                    data: 'assets/crime_data.geojson'
                },
                'layout': {
                    'icon-image': [
                        'match',
                        ['get', 'Offense Parent Group'],
                        ['LARCENY-THEFT'],
                        'theft',
                        ['ASSAULT OFFENSES'],
                        'assault',
                        ['BURGLARY/BREAKING&ENTERING'],
                        'burglar',
                        ['DESTRUCTION/DAMAGE/VANDALISM OF PROPERTY'],
                        'destruction',
                        ['DRIVING UNDER THE INFLUENCE'],
                        'dui',
                        ['DRUG/NARCOTIC OFFENSES'],
                        'drugs',
                        ['FRAUD OFFENSES'],
                        'fraud',
                        ['MOTOR VEHICLE THEFT'],
                        'mvt',
                        ['ROBBERY'],
                        'robbery',
                        ['TRESPASS OF REAL PROPERTY'],
                        'property',
                        'police'
                    ],
                    "icon-allow-overlap": true,
                    'icon-size': .5
                }
            });

            var nav = new mapboxgl.NavigationControl();
            map.addControl(nav, 'bottom-right');


            document.getElementById('filters').addEventListener('change', (event) => {
                const year = event.target.value;
                // update the map filter
                if (year === 'all') {
                    filterYear = ['!=', ['string', ['get', 'Report Number']], 'placeholder'];
                } else if (year === '2018') {
                    filterYear = ['match', ['get', 'Report Number'], ['2018'], true, false];
                } else if (year === '2019') {
                    filterYear = ['match', ['get', 'Report Number'], ['2019'], true, false];
                } else if (year === '2020') {
                    filterYear = ['match', ['get', 'Report Number'], ['2020'], true, false];
                } else if (year === '2021') {
                    filterYear = ['match', ['get', 'Report Number'], ['2021'], true, false];
                } else if (year === '2022') {
                    filterYear = ['match', ['get', 'Report Number'], ['2022'], true, false];
                } else {
                    console.log('error');
                }
                map.setFilter('crimes', ['all', filterYear]);
            });

            document.getElementById('crimetype').addEventListener('change', (event) => {
                const type = event.target.value;
                // update the map filter
                if (type === 'all') {
                    filterCrime = ['!=', ['string', ['get', 'Offense Parent Group']], 'placeholder'];
                } else if (type === 'assault') {
                    filterCrime = ['match', ['get', 'Offense Parent Group'], ['ASSAULT OFFENSES'], true, false];
                } else if (type === 'burglar') {
                    filterCrime = ['match', ['get', 'Offense Parent Group'], ['BURGLARY/BREAKING&ENTERING'], true, false];
                } else if (type === 'destruction') {
                    filterCrime = ['match', ['get', 'Offense Parent Group'], ['DESTRUCTION/DAMAGE/VANDALISM OF PROPERTY'], true, false];
                } else if (type === 'drugs') {
                    filterCrime = ['match', ['get', 'Offense Parent Group'], ['DRUG/NARCOTIC OFFENSES'], true, false];
                } else if (type === 'dui') {
                    filterCrime = ['match', ['get', 'Offense Parent Group'], ['DRIVING UNDER THE INFLUENCE'], true, false];
                } else if (type === 'fraud') {
                    filterCrime = ['match', ['get', 'Offense Parent Group'], ['FRAUD OFFENSES'], true, false];
                } else if (type === 'mvt') {
                    filterCrime = ['match', ['get', 'Offense Parent Group'], ['MOTOR VEHICLE THEFT'], true, false];
                } else if (type === 'property') {
                    filterCrime = ['match', ['get', 'Offense Parent Group'], ['TRESPASS OF REAL PROPERTY'], true, false];
                } else if (type === 'robbery') {
                    filterCrime = ['match', ['get', 'Offense Parent Group'], ['ROBBERY'], true, false];
                } else if (type === 'theft') {
                    filterCrime = ['match', ['get', 'Offense Parent Group'], ['LARCENY-THEFT'], true, false];
                } else {
                    console.log('error');
                }
                map.setFilter('crimes', ['all', filterCrime]);
            });

        });

        // click on tree to view magnitude in a popup
        map.on('click', 'crimes', (event) => {
            new mapboxgl.Popup()
                .setLngLat(event.features[0].geometry.coordinates)
                .setHTML(`<strong>Crime: </strong> ${event.features[0].properties['Offense']}`)
                .addTo(map);
        });

    </script>

</body>

</html>